## Integration Demo 2: NFC User ID Wireless Authentication

The second demonstration aimed to create a communication protocol between the smartlock electrical system and the intermediary Node application for accessing the Mongo database in order to perform user authentication via NFC.  The demonstration required the prototype smartlock electrical system, XBee coordinator, Raspberry Pi, and two NFC cards.  Of the two NFC cards used for the demonstration, only one card was added to the list of approved users in the web application.
To start the smartlock, the user would first push a button to initiate the NFC reader.  Once the reader was active, one of the two NFC cards was placed next to the reader for communication, which would collect a hexadecimal code identifying the NFC card.  Using the protocol specified in demonstration 1, the Arduino would collect available information and create the CSV string seen in Figure 55.

Figure 55.  CSV string.

Using the communication process proven in demonstration 1, the information would be relayed to the Meteor database through the XBee wireless connection and an intermediary Node.js application.  However, in this demonstration, the ability of the XBee modules to communicate bidirectionally and authenticate a user was tested.  Upon receipt of the new data, the Meteor application would determine if the NFC card identified was approved for access and would return a false value accordingly.  To monitor this process, the application included a table of received and sent values and the Arduino and NFC device would output serial data to see the data transfer in real time.
The authentication process compares the received NFC code to a server side-only database of registered users.  This step could also account for billing or other parameters necessary for the monetary function of the bikeshare.  The user information in the database was stored simply as a hex string, rather than the actual user’s name, university ID, or any other form of personally identifiable information (PID) to simulate the need to protect the users’ information in the final design.  Once the user ID string was run through the database comparisons, an “authorized/unauthorized” flag was set accordingly.  If the identification code matched a registered user who was in good standing, the database would return an authorize flag.  Any other case would return an unauthorized flag and permit the lock from being opened.  To explain this issue to a user, a notification, email, or text message could be sent to alert the user of the issue and suggest an appropriate solution.  Errors that might need fixing may be from an improperly linked credit card, a duplicate rental still open, or a more vague error that can be solved by connecting the user to customer support.
Once the authenticity of the user was determined, the system assembled an XBee packet that activated a specific XBee end device using the <Module_ID> field from the CSV string.  With the packet configured, the AT request was sent to the XBee coordinator from the intermediary application and then to the specified end device.  The end device received the message, which specified a specific pin to write as HIGH or LOW accordingly.  After initially sending the user information to the coordinator, the Arduino changed logic states to constantly poll the specified digital pin of the XBee module.  While the pin was LOW, the authentication flag was set to false.  Should the pin transition to HIGH, the authentication flag transitioned to true.  The intermediary Node application would then wait a set time delay before sending a LOW message again to reset the system after the pin was read.  The authentication flag dictated the change in the Arduino’s state when deciding whether or not the smartlock should be unlocked for the user.  To demonstrate the functionality of this state change, an LED was added to the smartlock prototype; a steady LED signal indicated the received signal was for an authenticated user, while a blinking LED indicated that the received signal denies access.
As expected, when the registered NFC card was used, the LED was lit continuously to signal success while using the other the NFC card resulted in the LED flashing.  The second demonstration was successful in relaying the NFC authentication information from the XBee end device to the Mongo DB.